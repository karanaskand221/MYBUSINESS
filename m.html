<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentor Dashboard - Karan SIR | Nashik</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --primary: #00b894; 
            --dark: #2d3436; 
            --accent: #00d4ff; 
            --white: #ffffff; 
            --danger: #141212;
            --success: #00b894;
            --warning: #fdcb6e;
            --pending: #fef3c7;
            --shadow-sm: 0 2px 10px rgba(0,0,0,0.08);
            --shadow-md: 0 8px 25px rgba(0,0,0,0.12);
            --border-radius: 12px;
        }

        * { box-sizing: border-box; }
        body { 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            background: #f5f7fa; 
            color: var(--dark);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }

        /* Sidebar - SAME AS FIRST */
        .sidebar { 
            position: fixed; 
            left: 0; 
            top: 0; 
            width: 280px; 
            height: 100vh; 
            background: linear-gradient(180deg, var(--primary), #00a085); 
            color: white; 
            transform: translateX(-100%); 
            transition: transform 0.3s ease; 
            z-index: 2000; 
            padding: 20px 0; 
            box-shadow: 2px 0 20px rgba(0,0,0,0.1); 
        }
        .sidebar.active { transform: translateX(0); }
        .sidebar-header { padding: 0 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.2); text-align: center; }
        .logo { font-size: 1.8rem; font-weight: 700; margin: 0; }
        .sidebar-menu { list-style: none; padding: 20px 0; margin: 0; }
        .menu-item { 
            padding: 15px 25px; 
            cursor: pointer; 
            transition: 0.3s; 
            display: flex; 
            align-items: center; 
        }
        .menu-item:hover { background: rgba(255,255,255,0.1); }
        .menu-item i { margin-right: 12px; width: 20px; }
        .menu-item.active { background: rgba(255,255,255,0.2); border-right: 4px solid white; }

        /* Header - SAME AS FIRST */
        .mentor-header {
            background: linear-gradient(135deg, var(--primary), #00a085); 
            color: white;
            padding: 15px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .mentor-welcome { 
            display: flex; 
            align-items: center; 
            gap: 12px;
            flex: 1;
        }
        .mentor-avatar {
            width: 48px; 
            height: 48px; 
            background: rgba(255,255,255,0.2); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.2rem; 
            font-weight: 600;
            flex-shrink: 0;
        }
        .mentor-info {
            flex: 1;
            overflow: hidden;
        }
        .mentor-name { 
            margin: 0 0 2px 0; 
            font-size: 1.1rem; 
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .mentor-greeting {
            margin: 0;
            opacity: 0.9; 
            font-size: 0.85rem;
        }
        .logout-btn { 
            background: rgba(255,255,255,0.2); 
            color: white; 
            border: 2px solid rgba(255,255,255,0.3); 
            padding: 10px 18px; 
            border-radius: var(--border-radius); 
            cursor: pointer; 
            font-weight: 600;
            font-size: 0.9rem;
            min-width: 80px;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        .logout-btn:hover { 
            background: rgba(255,255,255,0.3); 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Main Container - SAME AS FIRST */
        .mentor-container {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 70px); 
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Stats Grid - SAME AS FIRST */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); 
            gap: 15px; 
            margin-bottom: 20px;
        }
        .stat-card { 
            background: white; 
            padding: 20px 15px; 
            border-radius: var(--border-radius); 
            text-align: center; 
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        .stat-card:hover::before { transform: scaleX(1); }
        .stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
        .stat-icon { 
            font-size: 1.8rem; 
            margin-bottom: 10px;
            display: block;
        }
        .stat-number { 
            font-size: 1.6rem; 
            font-weight: 700; 
            margin: 0 0 5px; 
        }
        .stat-label { 
            color: #64748b; 
            font-size: 0.8rem; 
            margin: 0;
        }
        .today-leads { color: var(--success); }
        .pending-leads { color: #92400e; }

        /* Filters - SAME AS FIRST */
        .filters-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 20px;
            margin-bottom: 20px;
        }
        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        .filter-select {
            padding: 14px 16px;
            border: 2px solid #e8ecf4;
            border-radius: var(--border-radius);
            font-size: 16px;
            min-height: 48px;
            background: white;
            width: 100%;
        }
        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,184,148,0.1);
        }
        .clear-filters {
            background: #6b7280;
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            min-height: 48px;
            transition: all 0.3s;
        }
        .clear-filters:hover { background: #4b5563; transform: translateY(-1px); }

        /* Candidates Section - SAME AS FIRST */
        .candidates-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            margin-bottom: 20px;
        }
        .section-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), #00a085);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .section-title {
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .view-btn {
            background: #fdcb6e;
            color: var(--dark);
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .view-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(253,203,110,0.4); }

        /* Mobile Cards - EXACT SAME AS FIRST */
        .candidates-list { display: block; }
        .candidate-card {
            display: flex;
            padding: 20px;
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s;
            cursor: pointer;
        }
        .candidate-card:hover { background: #f8fafc; }
        .candidate-card:active { background: #e2e8f0; }
        
        .candidate-info { flex: 1; min-width: 0; }
        .candidate-name {
            font-weight: 600;
            margin: 0 0 4px 0;
            font-size: 1rem;
        }
        .candidate-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 0.85rem;
            color: #64748b;
        }
        .candidate-phone {
            font-weight: 600;
            color: var(--primary);
        }
        .candidate-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        .candidate-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* Badges & Buttons - SAME AS FIRST */
        .status-badge, .call-status-badge { 
            padding: 6px 12px; 
            border-radius: 20px; 
            font-size: 0.75rem; 
            font-weight: 600; 
            cursor: pointer;
            min-width: 80px;
            text-align: center;
            transition: all 0.3s;
        }
        .status-pending { 
            background: var(--pending); 
            color: #92400e; 
        }
        .status-converted { 
            background: #d1fae5; 
            color: #065f46; 
        }
        .call-status-not_called { background: #e2e8f0; color: #4a5568; }
        .call-status-call_cut { background: #ffcccb; color: #c53030; }
        .call-status-call_received { background: #d1fae5; color: #065f46; }
        .call-status-call_him_back { background: #fef3c7; color: #92400e; }
        .call-status-call_not_received { background: #e2e8f0; color: #4a5568; }
        .call-status-busy { background: #fed7d7; color: #c53030; }
        
        .call-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
            text-decoration: none;
        }
        .call-btn:hover { background: #059669; transform: translateY(-1px); }
        .call-btn:active { transform: translateY(0); }
        .action-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .action-btn.edit-btn { background: rgba(0,184,148,0.1); color: var(--primary); }
        .action-btn.delete-btn { background: rgba(239,68,68,0.1); color: #ef4444; }
        .action-btn:hover { transform: scale(1.1); }
        .action-btn:active { transform: scale(0.95); }

        /* FAB & Form - SAME AS FIRST */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #00a085);
            border: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s;
        }
        .fab:hover { transform: scale(1.1); box-shadow: 0 12px 35px rgba(0,184,148,0.4); }
        .fab:active { transform: scale(0.95); }
        .form-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            padding: 30px;
            margin: 20px 0;
            display: none;
        }

        /* Edit Modal - SAME AS FIRST */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            backdrop-filter: blur(8px);
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: var(--border-radius);
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-md);
        }
        .edit-modal-content { width: 90%; max-width: 500px; padding: 25px; }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-modal:hover { background: #f3f4f6; color: var(--dark); }
        .form-group { 
            margin-bottom: 20px; 
        }
        .form-group label { 
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px; 
            font-weight: 600; 
            font-size: 0.95rem;
        }
        .form-group input,
        .form-group select { 
            width: 100%; 
            padding: 14px 16px; 
            border: 2px solid #e8ecf4; 
            border-radius: var(--border-radius); 
            font-size: 16px; 
            min-height: 48px;
            transition: all 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus { 
            outline: none; 
            border-color: var(--primary); 
            box-shadow: 0 0 0 3px rgba(0,184,148,0.1); 
        }
        .phone-required { border-color: #ef4444 !important; }
        .add-candidate-btn, .save-edit-btn {
            width: 100%; 
            padding: 16px; 
            background: linear-gradient(135deg, var(--primary), #00a085); 
            color: white; 
            border: none; 
            border-radius: var(--border-radius); 
            font-size: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            min-height: 48px;
            transition: all 0.3s; 
        }
        .add-candidate-btn:hover, .save-edit-btn:hover {
            transform: translateY(-2px); 
            box-shadow: 0 10px 25px rgba(0,184,148,0.4); 
        }

        /* Responsive - Cards Primary + Table Desktop */
        @media (max-width: 768px) {
            .mentor-header { padding: 12px 16px; }
            .mentor-container { padding: 16px 12px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .stat-card { padding: 16px 12px; }
            .stat-number { font-size: 1.4rem; }
            .candidate-card { 
                flex-direction: column; 
                gap: 12px; 
                padding: 20px 16px;
            }
            .candidate-actions { 
                flex-direction: row; 
                width: 100%; 
                justify-content: flex-end; 
            }
            .call-btn { 
                flex: 1; 
                max-width: 200px; 
                justify-content: center;
            }
            .section-header { 
                flex-direction: column; 
                gap: 12px; 
                align-items: stretch; 
            }
            .filter-group { grid-template-columns: 1fr; }
            .filters-header { flex-direction: column; gap: 12px; align-items: stretch; }
            .modal-content { width: 95%; margin: 10px; transform: translate(-50%, -50%) scale(0.98); }
            .fab { bottom: 16px; right: 16px; width: 52px; height: 52px; }
        }
        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; }
            .mentor-container { padding: 12px 8px; }
        }
        @media (min-width: 769px) {
            .candidate-card { padding: 16px 20px; }
            .mentor-container { padding: 24px; }
        }
    </style>
</head>
<body>
    <!-- EXACT SAME HTML STRUCTURE AS FIRST -->
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="logo">Karan SIR</h2>
        </div>
        <ul class="sidebar-menu">
            <li class="menu-item active" onclick="goToMain()">
                <i class="fas fa-home"></i>
                Dashboard
            </li>
            <li class="menu-item" onclick="toggleSidebar()">
                <i class="fas fa-users"></i>
                Candidates
            </li>
            <li class="menu-item" onclick="openViewModal()">
                <i class="fas fa-chart-line"></i>
                Report
            </li>
            <li class="menu-item" onclick="toggleSidebar()">
                <i class="fas fa-cog"></i>
                Settings
            </li>
        </ul>
    </nav>

    <!-- Header -->
    <header class="mentor-header">
        <div class="mentor-welcome" onclick="toggleSidebar()">
            <div class="mentor-avatar" id="mentorAvatar">K</div>
            <div class="mentor-info">
                <h3 class="mentor-name" id="mentorName">Karan Sir</h3>
                <p class="mentor-greeting">Welcome back! Have a great day</p>
            </div>
        </div>
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i>
            Logout
        </button>
    </header>

    <!-- Main Container -->
    <main class="mentor-container">
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-users stat-icon today-leads"></i>
                <div class="stat-number" id="todayLeads">0</div>
                <div class="stat-label">Today Leads</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-user-check stat-icon"></i>
                <div class="stat-number" id="totalCandidates">0</div>
                <div class="stat-label">Total Candidates</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-phone stat-icon pending-leads"></i>
                <div class="stat-number" id="pendingLeads">0</div>
                <div class="stat-label">Pending Calls</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-trophy stat-icon"></i>
                <div class="stat-number" id="convertedLeads">0</div>
                <div class="stat-label">Converted</div>
            </div>
        </div>

        <!-- Filters -->
        <section class="filters-section">
            <div class="filters-header">
                <h3><i class="fas fa-filter"></i> Filters</h3>
                <button class="clear-filters" onclick="clearFilters()">Clear All</button>
            </div>
            <div class="filter-group">
                <select class="filter-select" id="filterCallStatus" onchange="applyFilters()">
                    <option value="">All Call Status</option>
                    <option value="not_called">Not Called</option>
                    <option value="call_cut">Call Cut</option>
                    <option value="call_received">Call Received</option>
                    <option value="call_him_back">Call Him Back</option>
                    <option value="call_not_received">Not Received</option>
                    <option value="busy">Busy</option>
                </select>
                <select class="filter-select" id="filterStatus" onchange="applyFilters()">
                    <option value="">All Status</option>
                    <option value="Pending Follow-up">Pending</option>
                    <option value="Converted">Converted</option>
                </select>
                <select class="filter-select" id="filterWorkType" onchange="applyFilters()">
                    <option value="">All Work Types</option>
                    <option value="Full Time">Full Time</option>
                    <option value="Part Time">Part Time</option>
                    <option value="Freelance">Freelance</option>
                </select>
            </div>
        </section>

        <!-- Candidates Section -->
        <section class="candidates-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    Candidates List
                </h2>
                <button class="view-btn" onclick="openViewModal()">
                    <i class="fas fa-file-pdf"></i>
                    Generate Report
                </button>
            </div>

            <!-- Mobile Cards - Primary View -->
            <div class="candidates-list" id="candidatesList">
                <!-- Cards populated by JS -->
            </div>
        </section>

        <!-- Add New Form -->
        <section class="form-section" id="addFormSection">
            <h3><i class="fas fa-plus-circle"></i> Add New Candidate</h3>
            <form id="candidateForm">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-phone"></i> Phone <span style="color: #ef4444;">*</span></label>
                    <input type="tel" id="phone" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-graduation-cap"></i> Education</label>
                    <input type="text" id="education">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-calendar-alt"></i> Age</label>
                    <input type="number" id="age">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-map-marker-alt"></i> Address</label>
                    <input type="text" id="address">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-briefcase"></i> Work Type</label>
                    <select id="workType">
                        <option value="Full Time">Full Time</option>
                        <option value="Part Time">Part Time</option>
                        <option value="Freelance">Freelance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-star"></i> Experience</label>
                    <input type="text" id="experience" value="Fresher">
                </div>
                <button type="submit" class="add-candidate-btn">
                    <i class="fas fa-plus"></i> Add Candidate
                </button>
            </form>
        </section>
    </main>

    <!-- FAB -->
    <button class="fab" onclick="scrollToForm()" title="Add New Candidate">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Edit Modal -->
    <div class="edit-modal" id="editModal">
        <div class="modal-content">
            <div class="edit-modal-content">
                <div class="close-modal" onclick="closeEditModal()">&times;</div>
                <h3><i class="fas fa-edit"></i> Edit Candidate</h3>
                <form id="editForm">
                    <input type="hidden" id="editCandidateId">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Full Name</label>
                        <input type="text" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-phone"></i> Phone <span style="color: #ef4444;">*</span></label>
                        <input type="tel" id="editPhone"
                    <input type="tel" id="editPhone" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-graduation-cap"></i> Education</label>
                    <input type="text" id="editEducation">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-calendar-alt"></i> Age</label>
                    <input type="number" id="editAge">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-map-marker-alt"></i> Address</label>
                    <input type="text" id="editAddress">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-briefcase"></i> Work Type</label>
                    <select id="editWorkType">
                        <option value="Full Time">Full Time</option>
                        <option value="Part Time">Part Time</option>
                        <option value="Freelance">Freelance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-star"></i> Experience</label>
                    <input type="text" id="editExperience" value="Fresher">
                </div>
                <button type="submit" class="save-edit-btn">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    // SAME MENTORS DATA FROM MAIN PAGE
    const mentors = JSON.parse(localStorage.getItem('mentors')) || [
        { id: 'karan', name: 'HR.KARAN ASKAND SIR', password: 'KK17', students: 45, earnings: 'â‚¹2.5L' },
        { id: 'akanksha', name: 'HR.AKANKSHA MAM', password: 'A123456', students: 31, earnings: 'â‚¹1.8L' },
        { id: 'pratham', name: 'HR.PRATHMESH PARDESHI SIR', password: 'P123456', students: 32, earnings: 'â‚¹1.9L' },
        { id: 'garima', name: 'HR.GARIMA PANDEY MAM', password: 'G123456', students: 34, earnings: 'â‚¹1.5L' },
        { id: 'vishal', name: 'HR.VISHAL PANSARE SIR', password: 'V123456', students: 37, earnings: 'â‚¹1.6L' },
        { id: 'tushar', name: 'HR.TUSHAR DEORE SIR', password: 'T123456', students: 38, earnings: 'â‚¹1.7L' }
    ];

    // Global variables
    const mentorData = JSON.parse(localStorage.getItem('mentorLoggedIn'));
    let candidates = JSON.parse(localStorage.getItem(`candidates_${mentorData?.id}`)) || [];
    let editingCandidateId = null;
    let currentFilters = {
        callStatus: '',
        status: '',
        workType: ''
    };

    // Security check
    if (!mentorData) {
        window.location.href = 'index.html';
    }

    // Initialize dashboard
    function initDashboard() {
        document.getElementById('mentorName').textContent = mentorData.name;
        document.getElementById('mentorAvatar').textContent = mentorData.name.charAt(3);
        renderMobileCards();
        updateStats();
    }

    // Save data to localStorage
    function saveData() {
        localStorage.setItem(`candidates_${mentorData.id}`, JSON.stringify(candidates));
    }

    // Toggle sidebar (SAME AS MAIN PAGE)
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('active');
    }

    // Navigation
    function goToMain() {
        window.location.href = 'index.html';
    }

    // Logout
    function logout() {
        localStorage.removeItem('mentorLoggedIn');
        localStorage.removeItem('adminLoggedIn');
        window.location.href = 'index.html';
    }

    // Scroll to add form
    function scrollToForm() {
        document.getElementById('addFormSection').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
        document.getElementById('addFormSection').style.display = 'block';
    }

    // ðŸš€ FIXED: DIRECT view.html POPUP (NO MODAL)
    function openViewModal() {
        // Save ALL filtered data to sessionStorage
        sessionStorage.setItem('pdfCandidates', JSON.stringify({
            candidates: candidates,
            currentFilters: currentFilters,
            mentorData: mentorData,
            stats: {
                today: document.getElementById('todayLeads').textContent,
                pending: document.getElementById('pendingLeads').textContent,
                converted: document.getElementById('convertedLeads').textContent,
                filtered: document.getElementById('totalCandidates').textContent
            }
        }));
        
        // âœ… DIRECT NEW WINDOW - PERFECT SIZE
        const pdfWindow = window.open(
            'view.html', 
            'pdfViewer', 
            'width=1400,height=900,scrollbars=yes,resizable=yes,top=50,left=50'
        );
        
        if (pdfWindow) {
            pdfWindow.focus();
        } else {
            alert('Please allow popups for this site to view PDF!');
        }
    }

    // Call status labels
    function getCallStatusLabel(callStatus) {
        const labels = {
            'not_called': 'Not Called',
            'call_cut': 'Call Cut',
            'call_received': 'Call Received',
            'call_him_back': 'Call Him Back',
            'call_not_received': 'Not Received',
            'busy': 'Busy'
        };
        return labels[callStatus] || callStatus;
    }

    // Call status badges (clickable cycle)
    function getCallStatusBadge(callStatus, candidateId) {
        const statuses = {
            'not_called': `<span class="call-status-badge call-status-not_called" onclick="cycleCallStatus(${candidateId}, 'call_cut')">Not Called</span>`,
            'call_cut': `<span class="call-status-badge call-status-call_cut" onclick="cycleCallStatus(${candidateId}, 'call_received')">Call Cut</span>`,
            'call_received': `<span class="call-status-badge call-status-call_received" onclick="cycleCallStatus(${candidateId}, 'call_him_back')">Call Received</span>`,
            'call_him_back': `<span class="call-status-badge call-status-call_him_back" onclick="cycleCallStatus(${candidateId}, 'call_not_received')">Call Him Back</span>`,
            'call_not_received': `<span class="call-status-badge call-status-call_not_received" onclick="cycleCallStatus(${candidateId}, 'busy')">Not Received</span>`,
            'busy': `<span class="call-status-badge call-status-busy" onclick="cycleCallStatus(${candidateId}, 'not_called')">Busy</span>`
        };
        return statuses[callStatus] || statuses['not_called'];
    }

    // Cycle call status
    function cycleCallStatus(candidateId, nextStatus) {
        const candidate = candidates.find(c => c.id === candidateId);
        if (candidate) {
            candidate.callStatus = nextStatus;
            saveData();
            renderMobileCards();
            updateStats();
        }
    }

    // Apply filters
    function applyFilters() {
        currentFilters.callStatus = document.getElementById('filterCallStatus').value;
        currentFilters.status = document.getElementById('filterStatus').value;
        currentFilters.workType = document.getElementById('filterWorkType').value;
        renderMobileCards();
        updateStats();
    }

    // Clear filters
    function clearFilters() {
        document.getElementById('filterCallStatus').value = '';
        document.getElementById('filterStatus').value = '';
        document.getElementById('filterWorkType').value = '';
        currentFilters = { callStatus: '', status: '', workType: '' };
        renderMobileCards();
        updateStats();
    }

    // Render mobile cards (PRIMARY VIEW - ALL DEVICES) - EXACT SAME LOGIC AS FIRST
    function renderMobileCards() {
        const container = document.getElementById('candidatesList');
        const filteredCandidates = [...candidates]
            .sort((a, b) => new Date(b.entryFull) - new Date(a.entryFull))
            .filter(candidate => {
                return (!currentFilters.callStatus || candidate.callStatus === currentFilters.callStatus) &&
                       (!currentFilters.status || candidate.status === currentFilters.status) &&
                       (!currentFilters.workType || candidate.workType === currentFilters.workType);
            });
        
        container.innerHTML = filteredCandidates.map(candidate => {
            const statusClass = candidate.status === 'Pending Follow-up' ? 'status-pending' : 'status-converted';
            const callStatusBadge = getCallStatusBadge(candidate.callStatus || 'not_called', candidate.id);
            
            return `
                <div class="candidate-card">
                    <div class="candidate-info">
                        <h4 class="candidate-name">${candidate.name || 'N/A'}</h4>
                        <div class="candidate-meta">
                            <span class="candidate-phone">
                                <i class="fas fa-phone"></i> 
                                <a href="tel:${candidate.phone}" style="color: var(--primary); text-decoration: none;">${candidate.phone}</a>
                            </span>
                            <span><i class="fas fa-graduation-cap"></i> ${candidate.education || 'N/A'}</span>
                            <span><i class="fas fa-calendar-alt"></i> ${candidate.age || 'N/A'}</span>
                            <span><i class="fas fa-map-marker-alt"></i> ${candidate.address || 'N/A'}</span>
                            <span><i class="fas fa-briefcase"></i> ${candidate.workType || 'N/A'}</span>
                            ${callStatusBadge}
                            <span class="status-badge ${statusClass}" onclick="toggleStatus(${candidate.id})">${candidate.status}</span>
                            <span><i class="fas fa-calendar"></i> ${new Date(candidate.entryFull).toLocaleDateString('en-IN')}</span>
                        </div>
                    </div>
                    <div class="candidate-actions">
                        <a href="tel:${candidate.phone}" class="call-btn" onclick="makeCall('${candidate.phone}')">
                            <i class="fas fa-phone"></i> Call
                        </a>
                        <button class="action-btn edit-btn" onclick="editCandidate(${candidate.id})" title="Edit">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteCandidate(${candidate.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Update stats
    function updateStats() {
        const today = candidates.filter(c => 
            new Date(c.entryFull).toDateString() === new Date().toDateString()
        ).length;
        const pending = candidates.filter(c => c.status === 'Pending Follow-up').length;
        const converted = candidates.filter(c => c.status === 'Converted').length;
        const filteredCount = document.querySelectorAll('.candidates-list .candidate-card').length;

        document.getElementById('todayLeads').textContent = today;
        document.getElementById('pendingLeads').textContent = pending;
        document.getElementById('convertedLeads').textContent = converted;
        document.getElementById('totalCandidates').textContent = filteredCount;
    }

    // Edit candidate
    function editCandidate(candidateId) {
        const candidate = candidates.find(c => c.id === candidateId);
        if (!candidate) return;

        editingCandidateId = candidateId;
        document.getElementById('editCandidateId').value = candidate.id;
        document.getElementById('editPhone').value = candidate.phone;
        document.getElementById('editName').value = candidate.name || '';
        document.getElementById('editAge').value = candidate.age || '';
        document.getElementById('editEducation').value = candidate.education || '';
        document.getElementById('editWorkType').value = candidate.workType || '';
        document.getElementById('editAddress').value = candidate.address || '';
        document.getElementById('editExperience').value = candidate.experience || '';

        document.getElementById('editModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    function closeEditModal() {
        document.getElementById('editModal').style.display = 'none';
        document.body.style.overflow = '';
        editingCandidateId = null;
    }

    // Make call
    function makeCall(phone) {
        window.location.href = `tel:${phone}`;
        const candidate = candidates.find(c => c.phone === phone);
        if (candidate) {
            candidate.callStatus = 'call_him_back';
            saveData();
            renderMobileCards();
            updateStats();
        }
    }

    // Toggle status
    function toggleStatus(candidateId) {
        const candidate = candidates.find(c => c.id === candidateId);
        if (candidate) {
            candidate.status = candidate.status === 'Pending Follow-up' ? 'Converted' : 'Pending Follow-up';
            saveData();
            renderMobileCards();
            updateStats();
        }
    }

    // Delete candidate
    function deleteCandidate(candidateId) {
        if (confirm('Are you sure you want to delete this candidate?')) {
            candidates = candidates.filter(c => c.id !== candidateId);
            saveData();
            renderMobileCards();
            updateStats();
            alert('âœ… Candidate deleted successfully!');
        }
    }

    // Form submissions
    document.getElementById('editForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const phone = document.getElementById('editPhone').value;
        
        if (!phone) {
            alert('âŒ Phone number is required!');
            return;
        }

        // Check duplicate phone
        const otherCandidates = candidates.filter(c => c.id !== editingCandidateId);
        const phoneExists = otherCandidates.some(c => c.phone === phone);
        if (phoneExists) {
            alert('âŒ Phone number already exists!');
            return;
        }

        const candidateIndex = candidates.findIndex(c => c.id === editingCandidateId);
        if (candidateIndex !== -1) {
            candidates[candidateIndex] = {
                ...candidates[candidateIndex],
                phone,
                name: document.getElementById('editName').value || '',
                age: document.getElementById('editAge').value || '',
                education: document.getElementById('editEducation').value || '',
                workType: document.getElementById('editWorkType').value || '',
                address: document.getElementById('editAddress').value || '',
                experience: document.getElementById('editExperience').value || 'Fresher'
            };
            
            saveData();
            renderMobileCards();
            updateStats();
            closeEditModal();
            alert('âœ… Candidate updated successfully!');
        }
    });

    document.getElementById('candidateForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const phone = document.getElementById('phone').value;
        
        if (!phone) {
            alert('âŒ Phone number is required!');
            return;
        }

        // Check duplicate phone
        const phoneExists = candidates.some(c => c.phone === phone);
        if (phoneExists) {
            alert('âŒ Phone number already exists!');
            return;
        }

        const newCandidate = {
            id: Date.now(),
            name: document.getElementById('name').value || '',
            phone: phone,
            age: document.getElementById('age').value || '',
            education: document.getElementById('education').value || '',
            address: document.getElementById('address').value || '',
            workType: document.getElementById('workType').value || '',
            experience: document.getElementById('experience').value || 'Fresher',
            status: 'Pending Follow-up',
            callStatus: 'not_called',
            entryTime: new Date().toLocaleDateString('en-IN'),
            entryFull: new Date().toISOString()
        };
        
        candidates.unshift(newCandidate);
        saveData();
        e.target.reset();
        renderMobileCards();
        updateStats();
        document.getElementById('addFormSection').style.display = 'none';
        alert('âœ… Candidate added successfully!');
    });

    // Modal backdrop clicks
    document.getElementById('editModal').addEventListener('click', (e) => {
        if (e.target.classList.contains('edit-modal')) {
            closeEditModal();
        }
    });

    // DOUBLE-CLICK SIDEBAR (SAME AS MAIN PAGE)
    document.addEventListener('dblclick', (e) => {
        if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'SELECT' && e.target.tagName !== 'BUTTON') {
            toggleSidebar();
        }
    });

    // Close sidebar on outside click
    document.addEventListener('click', (e) => {
        const sidebar = document.getElementById('sidebar');
        if (sidebar.classList.contains('active') && !sidebar.contains(e.target)) {
            sidebar.classList.remove('active');
        }
    });

    // Initialize
    initDashboard();
</script>
</body>
</html>
